<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.552">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-10-10">

<title>ABM User Guide</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="ABM_guide_files/libs/clipboard/clipboard.min.js"></script>
<script src="ABM_guide_files/libs/quarto-html/quarto.js"></script>
<script src="ABM_guide_files/libs/quarto-html/popper.min.js"></script>
<script src="ABM_guide_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="ABM_guide_files/libs/quarto-html/anchor.min.js"></script>
<link href="ABM_guide_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="ABM_guide_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="ABM_guide_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="ABM_guide_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="ABM_guide_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="ABM_guide_files/libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="ABM_guide_files/libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="ABM_guide_files/libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#guide-to-the-annual-bibliometric-monitoring-at-kth" id="toc-guide-to-the-annual-bibliometric-monitoring-at-kth" class="nav-link active" data-scroll-target="#guide-to-the-annual-bibliometric-monitoring-at-kth">Guide to the Annual Bibliometric Monitoring at KTH</a>
  <ul class="collapse">
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background">Background</a></li>
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#publications-in-diva" id="toc-publications-in-diva" class="nav-link" data-scroll-target="#publications-in-diva">Publications in DiVA</a></li>
  <li><a href="#citation-impact" id="toc-citation-impact" class="nav-link" data-scroll-target="#citation-impact">Citation impact</a></li>
  <li><a href="#journal-impact" id="toc-journal-impact" class="nav-link" data-scroll-target="#journal-impact">Journal impact</a></li>
  <li><a href="#co-publishing" id="toc-co-publishing" class="nav-link" data-scroll-target="#co-publishing">Co-publishing</a></li>
  <li><a href="#open-access" id="toc-open-access" class="nav-link" data-scroll-target="#open-access">Open Access</a></li>
  <li><a href="#scopus" id="toc-scopus" class="nav-link" data-scroll-target="#scopus">Scopus</a></li>
  <li><a href="#sdg" id="toc-sdg" class="nav-link" data-scroll-target="#sdg">SDG</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ABM User Guide</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 10, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="guide-to-the-annual-bibliometric-monitoring-at-kth" class="level1">
<h1>Guide to the Annual Bibliometric Monitoring at KTH</h1>
<p>This guide gives an introduction to the Annual Bibliometric Monitoring (ABM) at KTH Royal Institute of Technology. The purpose of the guide is to help you navigate the presentation of results, to understand the bibliometric indicators used in the report, and to interpret the results.</p>
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>The aim of the ABM is to assist monitoring, research evaluation and quality assurance at KTH, but also to provide KTH organizations and researchers with information related to their publications. The ABM was introduced in 2013 and was published annually in the same format since then. In 2019, a project aiming to redesign and develop the ABM was started. This resulted in the current solution, maintaining the same information as in previous years but in a more flexible framework with a presentation that is more dynamic, extendable and easier to maintain. That is the version of ABM described here.</p>
<p>The ABM results are available at different levels, for KTH in total, Schools, Departments and for individual researchers. The report currently has the same format and contents at all levels. Data is presented for the last 10 years with a complete publication record, which in practice means the year before last autumn and the nine preceding years (i.e.&nbsp;in the spring of 2024, the ABM contains data for the publication years 2013-2022).</p>
<p>Only publications registered in DiVA and affiliated with KTH are included in the results (i.e.&nbsp;publications that KTH researchers have published at other organizations are excluded). Affiliations to KTH are based on the actual author affiliation as written in the published paper. Indicators under Citation/Journal impact and Co-publishing tabs are based on Web of Science<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, and indicators are therefore only presented for publications covered by Web of Science. Indicators under the Scopus and SDG tabs are only presented for publications covered by Scopus.</p>
<p>If a School or Department have changed name or the organizational structure has changed, publications affiliated to old organizational units have been assigned to the corresponding current unit when possible.</p>
</section>
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>The <em>Overview</em> tab includes key indicators displayed for the latest available time period<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> and general information about ABM and publication activities at KTH.</p>
<p>Most numbers on this tab are based on fractionalized counts, i.e.&nbsp;an author’s share of a publication is counted as 1/n where n denotes the number of authors. The exception is the <em>Co-publication</em> charts, which are based on full counts.</p>
<p>Overviews at the KTH, school and department level are available to everyone, except for the button for publication list download which is only available for logged in KTH users.</p>
<p><a href="media/image1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="media/image1.png" class="img-fluid" style="width:100.0%"></a></p>
<p>The individual view, only available to the researcher, also includes a link to edit publications in DiVA.</p>
<p><a href="media/image2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="media/image2.png" class="img-fluid" style="width:100.0%"></a></p>
</section>
<section id="publications-in-diva" class="level2">
<h2 class="anchored" data-anchor-id="publications-in-diva">Publications in DiVA</h2>
<p>The <em>Publications in DiVA</em> tab shows the number of publications registered in DiVA for the researcher or organizational unit, by year and by publication type. Web of Science (WoS) and Scopus coverage are also shown for each publication type. The validity of bibliometric indicators is in general higher if the share of publications covered is high. Results based on publications with a smaller share covered should be treated with caution.</p>
<p>There is a tab for fractionalized counts and one for full counts. Both graphs are based on the fractionalized counts table.</p>
<p><a href="media/image3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="media/image3.png" class="img-fluid" style="width:100.0%"></a></p>
</section>
<section id="citation-impact" class="level2">
<h2 class="anchored" data-anchor-id="citation-impact">Citation impact</h2>
<p>The <em>Citation impact</em> tab shows citation impact for the researcher’s/unit’s publications. All indicators on this tab are based on fractionalized counts.</p>
<p>The first table in this view shows the total and average number of citations after three years, i.e.&nbsp;citations received in the publication year and the two directly following years, as well as the share of publications that were not cited in that time. This table is based on the Web of Science document types Article, Proceedings paper, Review, Letter and Editorial.</p>
<p>The second table is based on the Web of Science document types Article and Review, and shows Field Normalized Citations (Cf) and the share of publications belonging to the 10 percent most cited in its field.</p>
<p>The normalization is done so that the citation value for each publication is divided by the average number of citations received by publications from the same year, within the same Web of Science category (or categories) and of the same document type. For more detailed descriptions of the field normalized indicators used at KTH, see <a href="https://kth-library.github.io/abm/Formal_definitions_field_normalized_citation.pdf">Formal definitions</a>.</p>
<p>Mean-based citation indicators (such as Cf) can be strongly affected by a single publication (or a few) with a very high citation count relative to its field, while the Share Top 10% indicator is less sensitive to outliers. In that sense, Cf and Share Top 10% are complementary. Since field normalized indicators are unstable at low publication counts, the citation indicators are presented both as yearly values (dots) with a volume weighted three-year sliding mean superimposed in the graph to indicate the overall trend (solid line). Indicators based on a small number of publications should still be interpreted with caution.</p>
<p><a href="media/image4.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="media/image4.png" class="img-fluid" style="width:100.0%"></a></p>
</section>
<section id="journal-impact" class="level2">
<h2 class="anchored" data-anchor-id="journal-impact">Journal impact</h2>
<p>The <em>Journal impact</em> tab shows the average citation impact of the journals where researcher’s/unit’s have published their publications. All numbers on this tab are based on fractionalized counts.</p>
<p>The table shows the average Journal Field Normalized Citations (JCf) and the share of publications in the 20 percent most cited journals in its Web of Science subject category/categories. This table is based on the publication types Article and Review.</p>
<p>The JCf and Share Top 20% indicators supplement each other the same way as the Cf and Share Top 10% indicators. By evaluating the impact of the journals rather than the publications themselves, these indicators supplement the picture of the publishing profile, and the journal indicators are often seen as a proxy of the quality of publication channels. JCf is also used as a part of the model for allocating KTH funding to the schools.</p>
<p><a href="media/image5.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="media/image5.png" class="img-fluid" style="width:100.0%"></a></p>
</section>
<section id="co-publishing" class="level2">
<h2 class="anchored" data-anchor-id="co-publishing">Co-publishing</h2>
<p>The <em>Co-publishing</em> tab shows the level of co-publication with universities and other organizations. All numbers on this tab are based on the Web of Science categories Article and Review and use full counts, i.e.&nbsp;a publication is counted as one even if there are many co-authors.</p>
<p>Here, a Swedish non-university co-publication means a publication with at least one address belonging to a Swedish organization outside academia while an International co-publication is a publication with at least two countries in the Web of Science addresses field.</p>
<p><a href="media/image6.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="media/image6.png" class="img-fluid" style="width:100.0%"></a> The sub-tab <em>Countries and organizations</em> contains list of the countries and organizations that the selected unit has co-published with, which can be searched and filtered. These tables are also summarized based on the number of co-authors on individual publications, to differentiate between smaller collaborations and collaborations based on large author groups. The number of rows shown can be selected under each table.</p>
<p><a href="media/image6b.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="media/image6b.png" class="img-fluid" style="width:100.0%"></a></p>
</section>
<section id="open-access" class="level2">
<h2 class="anchored" data-anchor-id="open-access">Open Access</h2>
<p>The <em>Open Access</em> tab shows the OA status of publications according to <a href="https://unpaywall.org">Unpaywall</a>. For a publication to be included, it needs to be marked as a peer reviewed publication in DiVA and have a Digital Object Identifier (DOI) that Unpaywall can recognice and determine an OA status for.</p>
<p>The statuses are presented as defined by Unpaywall. For further information, see “<a href="https://support.unpaywall.org/support/solutions/articles/44001777288-what-do-the-types-of-oa-status-green-gold-hybrid-and-bronze-mean-">What do the types of oa status mean?</a>” at the unpaywall.org support portal.</p>
<p><a href="media/image7.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="media/image7.png" class="img-fluid" style="width:100.0%"></a></p>
</section>
<section id="scopus" class="level2">
<h2 class="anchored" data-anchor-id="scopus">Scopus</h2>
<p>The <em>Scopus</em> tab presents bibliometric indicator data based on the Scopus database, as a complement to the indicators in the tabs <em>Citation impact</em>, <em>Journal impact</em> and <em>Co-publishing</em>. This <em>Scopus</em> tab has sub-tabs each containing data for one of these aspects. In <em>Citation impact</em>, the indicator for field-weighted normalized citations is called FWCI, which is similar to the Cf-indicator. The <em>Share Top 10%</em> is a direct parallell to the same indicator based on Web of Science data.</p>
<p>Field-normalization for the Scopus indicators are based on the same principles as the Web of Science-based indicators, but are based on the subject categories in the Scopus database and supplied directly by Scopus.</p>
<p><a href="media/image8_scopus.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="media/image8_scopus.png" class="img-fluid" style="width:100.0%"></a></p>
</section>
<section id="sdg" class="level2">
<h2 class="anchored" data-anchor-id="sdg">SDG</h2>
<p>The <em>SDG</em> tab provides an overview of how publications are mapped against the <a href="https://sdgs.un.org/goals">UN sustainability goals (SDG)</a>.</p>
<p>The mapping is provided from Scopus, and only publications present in the Scopus database are therefore included in the summary. Publications are mapped to SDGs based on search queries, using keywords found in titles, abstract and author keywords, and the full methodology is described by Scopus <a href="https://elsevier.digitalcommonsdata.com/datasets/87txkw7khs/1">here</a>. The same SDG-mapping is also used in e.g.&nbsp;the <a href="https://www.timeshighereducation.com/impactrankings"><em>Times Higher Education Impact ranking</em> (THE Impact ranking)</a>. Also note that individual publications can be mapped towards several SDGs.</p>
<p><a href="media/image9_sdg.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="media/image9_sdg.png" class="img-fluid" style="width:100.0%"></a></p>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Included indices: Science Citation Index Expended (SCIE), Social Sciences Citation Index (SSCI), Arts &amp;Humanities Citation Index (AHCI), Conference Proceedings Citation Index -Sciences (CPCI-S) and Conference Proceedings Citation Index -Social Sciences &amp; Humanities (CPCI -SSH)<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Last year with a complete publication record in DiVA (usually year of last autumn – 1), with a non-zero count, for the Total publications number, the full period for WoS/Scopus coverage and last three-year period with an indicator for the other numbers.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","loop":false,"descPosition":"bottom","openEffect":"zoom","selector":".lightbox"});
window.onload = () => {
  lightboxQuarto.on('slide_before_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    const href = trigger.getAttribute('href');
    if (href !== null) {
      const imgEl = window.document.querySelector(`a[href="${href}"] img`);
      if (imgEl !== null) {
        const srcAttr = imgEl.getAttribute("src");
        if (srcAttr && srcAttr.startsWith("data:")) {
          slideConfig.href = srcAttr;
        }
      }
    } 
  });

  lightboxQuarto.on('slide_after_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    if (window.Quarto?.typesetMath) {
      window.Quarto.typesetMath(slideNode);
    }
  });

};
          </script>




</body></html>